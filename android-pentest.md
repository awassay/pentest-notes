## Reversing APKs
- Use apktool to decompile the APK
```sh
apktool -d app.apk
```
- We can repack APKs using apktool b and the resulting .apk will be written to the ./dist folder. But we need to sign it!
```sh
cd ./app.apk/
apktool b
```
- To sign the APK, we need to create a keystore which will contain our signing key. To create a testing.keystore with a key named test_key, use keytool
```sh
keytool -genkey -v -keystore testing.keystore -alias test_key -keyalg RSA -keysize 2048 -validity 10000
```
- To sign an APK we use jarsigner
```sh
jarsigner -verbose -sigalg SHA1withRSA -digestalg SHA1 -keystore testing.keystore ./dist/app.apk test_key
# On newer Android versions SHA1 signatures still get rejected. In that case simply use the default algorithms
jarsigner -verbose -keystore testing.keystore app.apk test_key
```
- Errors when signing apks:
  - INSTALL_PARSE_FAILED_NO_CERTIFICATES: There is still something wrong with the signature. &rarr; Maybe you tried to install an unsigned apk or the chosen algorithm (eg. SHA1) gets rejected.
  - INSTALL_FAILED_INVALID_APK: Failed to extract native libraries &rarr; This error occurs with some versions of apktool if the app contains native-libraries. To fix it, edit the AndroidManifest.xml so that extractNativeLibs is set to true. Afterwards you need to repackage and re-sign your APK.
  - INSTALL_FAILED_UPDATE_INCOMPATIBLE: Package io.hextree.reversingexample signatures do not match previously installed version; ignoring! &rarr; You will get this message if a version of the app signed with a different key is installed on the device. The simple solution is to delete the existing app.
  - Failed parse during installPackageLI: Targeting R+ (version 30 and above) requires the resources.arsc of installed APKs to be stored uncompressed and aligned on a 4-byte boundary.
    - This happens on newer apps, try this alternative method using zipalign and apksigner coming with the specific version build tools:
      ```sh
      apktool b
      C:\Users\[user]\AppData\Local\Android\sdk\build-tools\34.0.0\zipalign -p -f -v 4 ./dist/<apktool_build>.apk aligned.apk
      C:\Users\[user]\AppData\Local\Android\sdk\build-tools\34.0.0\apksigner sign --ks ./testing.keystore ./aligned.apk
      ```
